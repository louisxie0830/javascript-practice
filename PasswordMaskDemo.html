<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Password Mask Demo – WebKit & Cross‑Browser Fallback</title>
  <style>
    :root{
      --fg:#111;--muted:#6b7280;--bg:#f8fafc;--acc:#2563eb;--card:#ffffff;--br:#e5e7eb;
    }
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,"Segoe UI",Roboto,Inter,Arial,sans-serif;background:var(--bg);color:var(--fg);margin:0;padding:24px}
    h1{font-size:22px;margin:0 0 14px}
    p{margin:0 0 14px;color:var(--muted)}
    .grid{display:grid;gap:16px;grid-template-columns:1fr}
    @media(min-width:960px){.grid{grid-template-columns:1.2fr 1fr}}
    .card{background:var(--card);border:1px solid var(--br);border-radius:16px;padding:16px;box-shadow:0 1px 2px rgba(0,0,0,.04)}
    .row{display:flex;gap:10px;align-items:center}
    label{font-size:12px;color:var(--muted)}
    .ctrl{display:grid;gap:10px;grid-template-columns:repeat(2,1fr)}
    .ctrl .full{grid-column:1/-1}
    input[type="text"],input[type="password"],input[type="color"],select{
      width:100%;padding:10px 12px;border-radius:10px;border:1px solid var(--br);background:#fff;font-size:16px
    }
    input[type="range"]{width:100%}
    .badge{display:inline-block;padding:3px 8px;border-radius:999px;background:#eef2ff;color:#3730a3;font-size:12px}
    .muted{color:var(--muted);font-size:12px}
    .split{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .hint{font-size:12px;color:var(--muted);margin-top:6px}
    .note{padding:10px 12px;border-radius:10px;background:#fff7ed;border:1px solid #fed7aa;color:#9a3412;font-size:13px}
    .switch{display:inline-flex;align-items:center;gap:8px}
    button{padding:8px 12px;border-radius:10px;border:1px solid var(--br);background:#fff;cursor:pointer}
    button:active{transform:translateY(1px)}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace}
  </style>
</head>
<body>
  <h1>密碼輸入框樣式 Demo（WebKit 掩碼 & 跨瀏覽器自訂）</h1>
  <p>左側：使用 <span class="mono">-webkit-text-security</span>（Chrome / Edge / Safari）。右側：用 JavaScript 模擬任何符號（所有瀏覽器）。</p>

  <div class="grid">
    <!-- WebKit / Chromium / Safari 原生掩碼變體 -->
    <section class="card" id="webkitCard">
      <div class="row" style="justify-content:space-between">
        <strong>原生掩碼（WebKit 系瀏覽器）</strong>
        <span id="wkBadge" class="badge">偵測中…</span>
      </div>
      <div class="hint">支援時可切換：disc / circle / square / none；不支援時，會退回原生 <span class="mono">type="password"</span>。</div>

      <div style="margin-top:12px" class="split">
        <div>
          <label>輸入框</label>
          <input id="wkInput" type="password" placeholder="輸入密碼…" autocomplete="new-password" />
          <div class="row" style="margin-top:8px;gap:8px">
            <button id="wkShow">顯示</button>
            <button id="wkClear">清空</button>
          </div>
        </div>
        <div>
          <label>掩碼類型</label>
          <select id="maskSelect">
            <option value="disc">disc (●)</option>
            <option value="circle">circle (◦)</option>
            <option value="square">square (■)</option>
            <option value="none">none</option>
          </select>
          <div class="hint">僅支援於 WebKit / Chromium / Safari</div>
        </div>
      </div>

      <div class="ctrl" style="margin-top:12px">
        <div>
          <label>字級 <span id="wkSizeVal" class="mono">16px</span></label>
          <input id="wkSize" type="range" min="12" max="48" step="1" value="16" />
        </div>
        <div>
          <label>間距 <span id="wkSpaceVal" class="mono">0px</span></label>
          <input id="wkSpace" type="range" min="0" max="12" step="1" value="0" />
        </div>
        <div class="full">
          <label>顏色</label>
          <input id="wkColor" type="color" value="#111111" />
        </div>
      </div>
      <div id="wkNote" class="note" style="display:none;margin-top:12px">此瀏覽器不支援 <span class="mono">-webkit-text-security</span>，已自動退回原生密碼欄位（不改變掩碼形狀）。</div>
    </section>

    <!-- 全瀏覽器可用：JS 模擬任意符號 -->
    <section class="card">
      <strong>跨瀏覽器自訂符號（JavaScript 模擬）</strong>
      <div class="hint">支援任何符號，例如 *、#、•、★；此欄位僅為視覺掩碼，真實值存在隱藏欄位。</div>

      <div class="split" style="margin-top:12px">
        <div>
          <label>顯示欄位（視覺掩碼）</label>
          <input id="simDisplay" type="text" inputmode="text" placeholder="輸入密碼…" autocomplete="off" />
          <div class="row" style="margin-top:8px;gap:8px">
            <button id="simShow">顯示</button>
            <button id="simClear">清空</button>
          </div>
        </div>
        <div>
          <label>真實值（隱藏）</label>
          <input id="simReal" type="password" readonly value="" />
        </div>
      </div>

      <div class="ctrl" style="margin-top:12px">
        <div>
          <label>自訂符號</label>
          <input id="simSymbol" type="text" value="*" maxlength="2" />
        </div>
        <div>
          <label>間距 <span id="simSpaceVal" class="mono">0px</span></label>
          <input id="simSpace" type="range" min="0" max="12" step="1" value="0" />
        </div>
        <div>
          <label>字級 <span id="simSizeVal" class="mono">16px</span></label>
          <input id="simSize" type="range" min="12" max="48" step="1" value="16" />
        </div>
        <div class="full">
          <label>顏色</label>
          <input id="simColor" type="color" value="#111111" />
        </div>
      </div>
      <p class="hint">※ Demo 重點在視覺呈現；此簡化實作假設在字串尾端輸入與刪除，未完整處理游標中間插入/選取貼上等情境。</p>
    </section>
  </div>

  <script>
    // ---- WebKit / Chromium 掩碼區 ----
    const wk = {
      input: document.getElementById('wkInput'),
      maskSelect: document.getElementById('maskSelect'),
      size: document.getElementById('wkSize'),
      sizeVal: document.getElementById('wkSizeVal'),
      space: document.getElementById('wkSpace'),
      spaceVal: document.getElementById('wkSpaceVal'),
      color: document.getElementById('wkColor'),
      showBtn: document.getElementById('wkShow'),
      clearBtn: document.getElementById('wkClear'),
      badge: document.getElementById('wkBadge'),
      note: document.getElementById('wkNote'),
      card: document.getElementById('webkitCard')
    };

    const supportsWebkit = ('webkitTextSecurity' in wk.input.style);

    function applyWkStyles(){
      wk.input.style.letterSpacing = wk.space.value + 'px';
      wk.input.style.fontSize = wk.size.value + 'px';
      wk.input.style.color = wk.color.value;
      wk.spaceVal.textContent = wk.space.value + 'px';
      wk.sizeVal.textContent = wk.size.value + 'px';

      if (supportsWebkit){
        wk.input.type = 'text';
        wk.input.style.webkitTextSecurity = wk.maskSelect.value;
      } else {
        wk.input.type = 'password';
      }
    }

    if (supportsWebkit){
      wk.badge.textContent = '已支援 WebKit 掩碼';
      wk.badge.style.background = '#ecfeff';
      wk.badge.style.color = '#155e75';
      wk.note.style.display = 'none';
    } else {
      wk.badge.textContent = '未支援 WebKit 掩碼';
      wk.badge.style.background = '#fee2e2';
      wk.badge.style.color = '#991b1b';
      wk.note.style.display = 'block';
      // 不支援時，禁用選單避免誤觸
      wk.maskSelect.disabled = true;
    }

    wk.maskSelect.addEventListener('change', applyWkStyles);
    wk.size.addEventListener('input', applyWkStyles);
    wk.space.addEventListener('input', applyWkStyles);
    wk.color.addEventListener('input', applyWkStyles);
    wk.showBtn.addEventListener('click', () => {
      if (wk.input.type === 'password') {
        wk.input.type = 'text';
      } else {
        // 僅當不支援 webkitTextSecurity，text 會暴露；保守處理
        wk.input.type = supportsWebkit ? 'text' : 'password';
      }
      wk.showBtn.textContent = (wk.input.type === 'password') ? '顯示' : '隱藏';
    });
    wk.clearBtn.addEventListener('click', () => { wk.input.value = ''; });

    applyWkStyles();

    // ---- 模擬符號區（跨瀏覽器） ----
    const sim = {
      display: document.getElementById('simDisplay'),
      real: document.getElementById('simReal'),
      symbol: document.getElementById('simSymbol'),
      space: document.getElementById('simSpace'),
      spaceVal: document.getElementById('simSpaceVal'),
      size: document.getElementById('simSize'),
      sizeVal: document.getElementById('simSizeVal'),
      color: document.getElementById('simColor'),
      showBtn: document.getElementById('simShow'),
      clearBtn: document.getElementById('simClear')
    };

    // 狀態：只處理尾端輸入/刪除（簡化）
    let realValue = '';

    function renderMask(){
      const sym = (sim.symbol.value || '*').slice(0,1);
      sim.display.value = sym.repeat(realValue.length);
    }

    function applySimStyles(){
      sim.display.style.letterSpacing = sim.space.value + 'px';
      sim.display.style.fontSize = sim.size.value + 'px';
      sim.display.style.color = sim.color.value;
      sim.spaceVal.textContent = sim.space.value + 'px';
      sim.sizeVal.textContent = sim.size.value + 'px';
    }

    sim.display.addEventListener('beforeinput', (e) => {
      // 可觀察輸入類型，但此處仍採簡化
    });

    sim.display.addEventListener('input', (e) => {
      const val = sim.display.value; // 目前是掩碼，長度代表實際長度
      const prevLen = realValue.length;
      const newLen = val.length;

      if (newLen > prevLen){
        // 追加字元（假設在尾端）
        const delta = newLen - prevLen;
        // 無法得知內容，示範以 \u2022 代表任意輸入，實務中應監聽 keypress/合成輸入
        realValue += ''.padEnd(delta, '•');
      } else if (newLen < prevLen){
        // 刪除尾端
        realValue = realValue.slice(0, newLen);
      }
      sim.real.value = realValue;
      renderMask();
    });

    // 以 keydown 粗略處理 Backspace 與一般按鍵（簡化，未處理組合輸入與貼上）
    sim.display.addEventListener('keydown', (e) => {
      if (e.key === 'Backspace'){
        realValue = realValue.slice(0, -1);
        sim.real.value = realValue;
        renderMask();
        e.preventDefault();
      } else if (e.key.length === 1 && !e.ctrlKey && !e.metaKey){
        realValue += e.key;
        sim.real.value = realValue;
        renderMask();
        e.preventDefault();
      }
    });

    sim.symbol.addEventListener('input', renderMask);
    sim.space.addEventListener('input', applySimStyles);
    sim.size.addEventListener('input', applySimStyles);
    sim.color.addEventListener('input', applySimStyles);
    sim.showBtn.addEventListener('click', () => {
      if (sim.real.type === 'password'){
        sim.real.type = 'text';
        sim.showBtn.textContent = '隱藏真實值';
      } else {
        sim.real.type = 'password';
        sim.showBtn.textContent = '顯示';
      }
    });
    sim.clearBtn.addEventListener('click', () => {
      realValue = '';
      sim.real.value = '';
      renderMask();
    });

    applySimStyles();
    renderMask();
  </script>
</body>
</html>